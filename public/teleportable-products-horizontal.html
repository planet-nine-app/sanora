<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planet Nine Products - Teleportable Feed (Horizontal)</title>
</head>
<body>
    <!-- Teleportable Product Feed -->
    <teleport id="planet-nine-products" type="feed" category="marketplace" signature="ff6af3a73523ca9c507e7e5e80c3bd7ba685efc409fd109c8f1751e4465a7f877d6232a67320f36a46798acd97b620a3ceb505151b98d0679e7684a61f630544" message="1754744190785:planet-nine-marketplace-products:teleport" pubKey="02a186f9448ec8457983159437a5487ec22e9e9b30557fbbb82254373e5447ef36">
        <feed-meta>
            <title>Planet Nine Marketplace</title>
            <description>Discover unique products from the Planet Nine ecosystem</description>
            <last-updated></last-updated>
            <source-url></source-url>
        </feed-meta>
        <!-- Products will be dynamically inserted here -->
    </teleport>

    <!-- Horizontal Scrolling Product Display -->
    <div style="
        width: 100%;
        padding: 20px 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        overflow-x: hidden;
    ">
        <div style="
            text-align: center;
            margin-bottom: 30px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            padding: 0 20px;
        ">
            <h1 style="font-size: 2.5em; margin-bottom: 10px;">🌌 Planet Nine Products</h1>
            <p style="font-size: 1.1em; opacity: 0.95;">Horizontal Scrolling Feed</p>
        </div>

        <!-- Horizontal scroll container wrapper -->
        <div style="
            position: relative;
            width: 100%;
            padding: 0 20px;
        ">
            <!-- Left scroll indicator -->
            <div id="scroll-left" style="
                position: absolute;
                left: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 60px;
                height: 60px;
                background: rgba(255,255,255,0.9);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 10;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                transition: transform 0.3s ease, opacity 0.3s ease;
                opacity: 0.7;
            " onmouseover="this.style.opacity='1'; this.style.transform='translateY(-50%) scale(1.1)'" 
               onmouseout="this.style.opacity='0.7'; this.style.transform='translateY(-50%) scale(1)'">
                <span style="font-size: 24px; color: #764ba2;">‹</span>
            </div>

            <!-- Right scroll indicator -->
            <div id="scroll-right" style="
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 60px;
                height: 60px;
                background: rgba(255,255,255,0.9);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 10;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                transition: transform 0.3s ease, opacity 0.3s ease;
                opacity: 0.7;
            " onmouseover="this.style.opacity='1'; this.style.transform='translateY(-50%) scale(1.1)'" 
               onmouseout="this.style.opacity='0.7'; this.style.transform='translateY(-50%) scale(1)'">
                <span style="font-size: 24px; color: #764ba2;">›</span>
            </div>

            <!-- Products container with horizontal scroll -->
            <div id="products-container" style="
                display: flex;
                gap: 20px;
                overflow-x: auto;
                overflow-y: hidden;
                scroll-behavior: smooth;
                padding: 20px 60px;
                scrollbar-width: thin;
                scrollbar-color: rgba(255,255,255,0.3) transparent;
            ">
                <!-- Products will be loaded here -->
            </div>
        </div>

        <div id="loading" style="
            text-align: center;
            color: white;
            padding: 40px;
            font-size: 1.2em;
        ">
            Loading products...
        </div>

        <!-- Custom scrollbar styles for webkit browsers -->
        <style>
            #products-container::-webkit-scrollbar {
                height: 10px;
            }
            #products-container::-webkit-scrollbar-track {
                background: rgba(255,255,255,0.1);
                border-radius: 10px;
            }
            #products-container::-webkit-scrollbar-thumb {
                background: rgba(255,255,255,0.3);
                border-radius: 10px;
            }
            #products-container::-webkit-scrollbar-thumb:hover {
                background: rgba(255,255,255,0.5);
            }
        </style>
    </div>

    <script>
        // Fetch products from sanora endpoint
        async function loadProducts() {
            try {
                // Determine base URL - adjust for your environment
                const baseUrl = window.location.hostname === 'localhost' 
                    ? 'http://127.0.0.1:7243'
                    : `https://${window.location.hostname}`;
                
                const response = await fetch(`${baseUrl}/products/base`);
                const productsData = await response.json();
                
                const container = document.getElementById('products-container');
                const loadingDiv = document.getElementById('loading');
                const teleportFeed = document.querySelector('teleport');
                const feedMeta = teleportFeed.querySelector('feed-meta');
                
                // Update feed metadata
                const lastUpdated = feedMeta.querySelector('last-updated');
                const sourceUrl = feedMeta.querySelector('source-url');
                lastUpdated.textContent = new Date().toISOString();
                sourceUrl.textContent = window.location.href;
                
                if (!productsData || Object.keys(productsData).length === 0) {
                    loadingDiv.innerHTML = '📦 No products available yet';
                    document.getElementById('scroll-left').style.display = 'none';
                    document.getElementById('scroll-right').style.display = 'none';
                    return;
                }
                
                loadingDiv.style.display = 'none';
                
                // Process each user's products
                Object.values(productsData).forEach(userProducts => {
                    Object.values(userProducts).forEach(product => {
                        // Create teleportal element for feed
                        const teleportal = createTeleportal(product);
                        teleportFeed.appendChild(teleportal);
                        
                        // Create visual product card
                        const card = createProductCard(product);
                        container.appendChild(card);
                    });
                });
                
                // Setup scroll controls
                setupScrollControls();
                
            } catch (error) {
                console.error('Failed to load products:', error);
                document.getElementById('loading').innerHTML = '❌ Failed to load products';
                document.getElementById('scroll-left').style.display = 'none';
                document.getElementById('scroll-right').style.display = 'none';
            }
        }
        
        function setupScrollControls() {
            const container = document.getElementById('products-container');
            const leftBtn = document.getElementById('scroll-left');
            const rightBtn = document.getElementById('scroll-right');
            
            // Scroll amount per click
            const scrollAmount = 350;
            
            leftBtn.onclick = () => {
                container.scrollLeft -= scrollAmount;
            };
            
            rightBtn.onclick = () => {
                container.scrollLeft += scrollAmount;
            };
            
            // Update button visibility based on scroll position
            function updateScrollButtons() {
                const isAtStart = container.scrollLeft <= 0;
                const isAtEnd = container.scrollLeft >= container.scrollWidth - container.clientWidth - 1;
                
                leftBtn.style.display = isAtStart ? 'none' : 'flex';
                rightBtn.style.display = isAtEnd ? 'none' : 'flex';
            }
            
            container.addEventListener('scroll', updateScrollButtons);
            // Initial check
            updateScrollButtons();
        }
        
        function createTeleportal(product) {
            const teleportal = document.createElement('teleportal');
            teleportal.id = product.productId || `product-${Date.now()}`;
            teleportal.setAttribute('category', product.category || 'general');
            teleportal.setAttribute('price', product.price || '0');
            teleportal.setAttribute('currency', product.currency || 'USD');
            
            // Add title element
            const title = document.createElement('title');
            title.textContent = product.title || 'Untitled Product';
            teleportal.appendChild(title);
            
            // Add description element
            const description = document.createElement('description');
            description.textContent = product.description || 'No description available';
            teleportal.appendChild(description);
            
            // Add URL element
            const url = document.createElement('url');
            const baseUrl = window.location.hostname === 'localhost' 
                ? 'http://127.0.0.1:7243'
                : `https://${window.location.hostname}`;
            url.textContent = `${baseUrl}/products/${product.uuid}/${encodeURIComponent(product.title)}`;
            teleportal.appendChild(url);
            
            // Add image URL if available
            const imageUrl = document.createElement('image');
            imageUrl.textContent = product.image 
                ? `${baseUrl}/images/${product.image}`
                : '';
            teleportal.appendChild(imageUrl);
            
            // Add tags
            const tags = document.createElement('tags');
            tags.textContent = product.tags || 'product,marketplace';
            teleportal.appendChild(tags);
            
            // Add stock status
            const inStock = document.createElement('in-stock');
            inStock.textContent = 'true';
            teleportal.appendChild(inStock);
            
            // Add rating if available
            const rating = document.createElement('rating');
            rating.textContent = product.rating || '0';
            teleportal.appendChild(rating);
            
            return teleportal;
        }
        
        function createProductCard(product) {
            const card = document.createElement('div');
            card.style.cssText = `
                background: white;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
                cursor: pointer;
                min-width: 300px;
                max-width: 300px;
                flex-shrink: 0;
            `;
            
            // Add hover effect
            card.onmouseover = () => {
                card.style.transform = 'translateY(-10px) scale(1.02)';
                card.style.boxShadow = '0 12px 30px rgba(0,0,0,0.3)';
            };
            card.onmouseout = () => {
                card.style.transform = 'translateY(0) scale(1)';
                card.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
            };
            
            // Image or placeholder
            const imageSection = document.createElement('div');
            imageSection.style.cssText = `
                height: 180px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 3em;
            `;
            
            if (product.image) {
                const baseUrl = window.location.hostname === 'localhost' 
                    ? 'http://127.0.0.1:7243'
                    : `https://${window.location.hostname}`;
                imageSection.style.background = `url(${baseUrl}/images/${product.image}) center/cover`;
            } else {
                imageSection.innerHTML = '📦';
            }
            
            card.appendChild(imageSection);
            
            // Content section
            const content = document.createElement('div');
            content.style.cssText = 'padding: 15px;';
            
            // Title
            const title = document.createElement('h3');
            title.style.cssText = `
                font-size: 1.2em;
                margin-bottom: 8px;
                color: #2c3e50;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            `;
            title.title = product.title || 'Untitled Product';
            title.textContent = product.title || 'Untitled Product';
            content.appendChild(title);
            
            // Description
            const description = document.createElement('p');
            description.style.cssText = `
                color: #7f8c8d;
                line-height: 1.4;
                margin-bottom: 12px;
                font-size: 0.9em;
                height: 2.8em;
                overflow: hidden;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
            `;
            description.textContent = product.description || 'No description available';
            content.appendChild(description);
            
            // Price
            const price = document.createElement('div');
            price.style.cssText = `
                font-size: 1.3em;
                font-weight: bold;
                color: #27ae60;
                margin-bottom: 12px;
            `;
            price.textContent = product.price ? `$${product.price}` : 'Free';
            content.appendChild(price);
            
            // View button
            const button = document.createElement('button');
            button.style.cssText = `
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 20px;
                font-size: 0.95em;
                font-weight: bold;
                cursor: pointer;
                width: 100%;
                transition: opacity 0.3s ease;
            `;
            button.textContent = 'View Product';
            button.onmouseover = (e) => {
                e.stopPropagation();
                button.style.opacity = '0.9';
            };
            button.onmouseout = (e) => {
                e.stopPropagation();
                button.style.opacity = '1';
            };
            button.onclick = (e) => {
                e.stopPropagation();
                const baseUrl = window.location.hostname === 'localhost' 
                    ? 'http://127.0.0.1:7243'
                    : `https://${window.location.hostname}`;
                window.open(`${baseUrl}/products/${product.uuid}/${encodeURIComponent(product.title)}`, '_blank');
            };
            content.appendChild(button);
            
            card.appendChild(content);
            
            return card;
        }
        
        // Load products when page loads
        window.addEventListener('DOMContentLoaded', loadProducts);
    </script>
</body>
</html>